---
title: "final"
author: "Cyrus Tadjiki"
date: "2/14/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "C:/Users/cyrus/OneDrive/EC 419/Crime-Project/data")
getwd()
```

```{r, Loading Packages}
setwd("C:/Users/cyrus/OneDrive/EC 419/Crime-Project/data")
library(pacman)
p_load(tidyverse, rvest, lubridate, janitor, 
       data.table, readr, readxl, dplyr, zoo,
       skimr, broom, tidyr, stringr, stats)
```


```{r, reading data}
# setwd("C:/Users/cyrus/Downloads/EC 419/Crime Data")
df = read.csv("data_draft_2.csv")
# census = read.csv(".csv")
```


# Summary Stats
```{r}
# skim(df)
```

```{r}
# new = subset(df, df$year=="NA")
# head(new)

no_nas = mutate_at(df, c( "share_all_closed_25",     
                          "share_all_closed_50",        
                          "share_all_closed_75",
                          "number_schools",
                          "total_students"),
               ~replace(., is.na(.), 0))
# log_reg = lm(child_crime~log(share_all_closed_25), data = no_nas)
# We can't do logs with zeros or NAs
# skim(no_nas)
```



# Regressions
```{r}
# reg_test = lm(child_crime~ten, data = df)
# tidy(reg_test)
reg1 = lm(child_crime~share_all_closed_25, data = df)
# reported crime / total students~ percent student home +grandparents
# tidy(reg1)
summary(reg1)
# reg2 = lm(partner_crime~students_home, data = df)
# tidy(reg2)
# summary(reg2)

# winter <- df[ which(df$month==1|
#                       df$month==2|
#                       df$month==3), ]
```


```{r}
fs = read.csv("data_draft_2.csv")
# making NAs 0 for plotting
fs = mutate_at(df, c( "share_all_closed_25",     
                          "share_all_closed_50",        
                          "share_all_closed_75",
                          "number_schools",
                          "total_students"),
               ~replace(., is.na(.), 0))

# piping data set together getting 4 helpful columns
fs = fs %>% group_by(year_month) %>% 
             summarise(
             child_crime_mean = mean(child_crime),
             partner_crime_mean = mean(partner_crime),
             child_crime = sum(child_crime),
             partner_crime = sum(partner_crime)) %>% 
             mutate(year_month = as.yearmon(year_month))

# Ordering by column year_month
fs <- fs[order(fs$year_month, decreasing= TRUE),]

# poo poo plot I made
# p0 = ggplot(fs, aes(x = year_month, y = child_crime)) + 
#   geom_col() + 
#   scale_x_yearmon()
# p0

# Mean
p1 = ggplot() + 
  geom_area(data = fs, aes(x = year_month, y = child_crime_mean, fill = "blue")) + 
  geom_area(data = fs, aes(x = year_month, y = partner_crime_mean, fill = "red")) + 
  scale_x_yearmon(n = 47) +
  scale_y_continuous(limits = c(0,50)) +
  theme(axis.text.x = element_text(angle = 75, vjust = 1, hjust=1),
        legend.title = element_text())+
  xlab("Time")+
  ylab("Crime Average") +
  guides(fill=guide_legend(title="Type of Crime")) +
  scale_fill_discrete(name = "Dose", labels = c("Child","Partner")) +
  labs(title = "Average amount of types of crime pre-covid to present")
p1

# Sum
p2 = ggplot() + 
  geom_area(data = fs, aes(x = year_month, y = child_crime, fill = "blue")) + 
  geom_area(data = fs, aes(x = year_month, y = partner_crime, fill = "red")) + 
  scale_x_yearmon(n = 47) +
  scale_y_continuous(limits = c(0,102185)) +
  theme(axis.text.x = element_text(angle = 75, vjust = 1, hjust=1),
        legend.title = element_text())+
  xlab("Time")+
  ylab("Crime Frequency") +
  guides(fill=guide_legend(title="Type of Crime")) +
  scale_fill_discrete(name = "Dose", labels = c("Child","Partner")) +
  labs(title = "Frequency of types of crime pre-covid to present")
p2
```




